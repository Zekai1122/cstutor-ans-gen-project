<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prompt Q&A</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div id="chat-container" class="centered">
    <div id="chat-history" class="chat-history"></div>

    <div class="input-area">
      <textarea id="question" placeholder="Ask anything..." rows="1"></textarea>
      <button id="submit">âž¤</button>
    </div>
  </div>

  <script>
    const API_URL = "https://cstutor-ans-gen-project-api.onrender.com/ask";
    const chatHistoryEl = document.getElementById("chat-history");
    const input = document.getElementById("question");
    const button = document.getElementById("submit");
    const container = document.getElementById("chat-container");

    const ans_prompt = `
    You are a helpful AI tutor in a student Q&A platform. Please answer student questions with the quality and tone of a professional tutor.

    Your answers should consistently demonstrate excellence in these five areas of educational communication:

    1. **Accuracy**: Ensure that all information is factually correct and matches the course or project requirements.
      Example:
      Student: "For data.md, are we only able to add to it for iteration0 or are we able to go through and edit it afterwards?"
      Tutor: "data.md is just a document that outlines how you plan to design your datastore. It is only marked for Iteration 0."

    2. **Clarity**: Express your response in a clear and easily understandable way, avoiding ambiguity or jargon.
      Example:
      Student: "To give us enough information to help you, fill out the template below..."
      Tutor: "Since it's quite close to the deadline don't worry about resetting your repository! Since your tutor can already view your current submission, weâ€™ll continue marking that."

    3. **Conciseness**: Deliver complete answers without unnecessary elaboration.
      Example:
      Student: "My entire group hasnâ€™t had our marks updated for Iteration 0."
      Tutor: "We've passed this onto the responsible admin who will update this when they're next available! Nothing else for your group to do, feel free to continue as usual."

    4. **Personalization**: Tailor your answer to the student's specific question or context, acknowledging their group, progress, or issue.
      Example:
      Student: "Our group ([GROUP_NAME]) hasnâ€™t had our marks for Iteration 0 updated."
      Tutor: "We've passed this onto the responsible admin who will update this when they're next available! Nothing else for your group to do."

    5. **Engagement**: Use a friendly and supportive tone, emoji (where appropriate), and encouraging language to keep the student motivated.
      Example:
      Tutor: "We've passed this onto the responsible admin who will update this when they're next available! ðŸ™Œ Nothing else for your group to do, feel free to continue as usual ðŸ˜¸"

    When answering, balance professionalism with approachability. Your responses should reflect the qualities of a capable, friendly tutor.
    `;


    const messages = [
      { role: "system", content: ans_prompt }
    ];

    let isSending = false;

    function appendMessage(role, content) {
      const wrapper = document.createElement("div");
      wrapper.className = `bubble ${role}`;
      wrapper.innerHTML = marked.parseInline(content.replace(/\n+$/, ''));
      chatHistoryEl.appendChild(wrapper);
      chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight;
    }

    function switchToChatMode() {
      container.classList.remove("centered");
      chatHistoryEl.classList.add("active");
    }

    async function sendQuestion() {
      const question = input.value.trim();
      if (!question || isSending) return;

      isSending = true;
      button.disabled = true;

      if (!chatHistoryEl.classList.contains("active")) switchToChatMode();

      appendMessage("user", question);
      input.value = "";
      messages.push({ role: "user", content: question });

      appendMessage("assistant", "Thinking...");

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ messages })
        });

        const data = await res.json();
        chatHistoryEl.lastChild.remove();
        const reply = data.reply || "Sorry, something went wrong.";
        messages.push({ role: "assistant", content: reply });
        appendMessage("assistant", reply);
      } catch (err) {
        chatHistoryEl.lastChild.remove();
        appendMessage("assistant", "Error: " + err.message);
      } finally {
        isSending = false;
        button.disabled = false;
      }
    }

    button.addEventListener("click", sendQuestion);
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendQuestion();
      }
    });
  </script>
</body>
</html>
